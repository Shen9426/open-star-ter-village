<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>
    // The code in this function runs when the page is loaded.
    $(document).ready(function () {
      google.script.run
        .withSuccessHandler(showCards)
        .withFailureHandler(showError)
        .getPlayerCards();
      $('#play-card').click(playCard);
    });

    function showCards(hand) {
      let list = $('#project-cards');
      list.empty();
      for (var i = 0; i < hand.projectCards.length; i++) {
        const id = `prj-${i}`;
        const dom = `<div>
            <input type="checkbox" id="${id}" class="card card-project" name="project-cards" value="${hand.projectCards[i]}" />
            <label for="${id}">${hand.projectCards[i]}</label>
          </div>`;
        list.append(dom);
      }
      list = $('#resource-cards');
      list.empty();
      for (var i = 0; i < hand.resourceCards.length; i++) {
        const id = `res-${i}`;
        const dom = `<div>
            <input type="checkbox" id="${id}" class="card card-resource" name="resource-cards" value="${hand.projectCards[i]}" />
            <label for="${id}">${hand.resourceCards[i]}</label>
          </div>`;
        list.append(dom);
      }
    }

    function showError(msg) {
      $('#error').text(msg)
    }

    function playCard() {
      const selectedProjectCards = $('input[name="project-cards"]:checked').map(function () {
        return $(this).val();
      }).get();
      if (selectedProjectCards.length > 1) {
        showError('select too many cards');
        return;
      }
      google.script.run.withFailureHandler(showError).playProjectCard(selectedProjectCards[0]);
    }
  </script>
</head>

<body>
  <div class="sidebar">
    <h1>
      <?= player ?>的手牌
    </h1>
    <form>
      <h2>專案卡</h2>
      <div id="project-cards" class="form-group">Loading...</div>
      <h2>資源卡</h2>
      <div id="resource-cards" class="form-group">Loading...</div>
      <button id="play-card" class="action">play card</button>
      <button id="discard-card">discard card</button>
    </form>
    <div id="error" class="error"></div>
  </div>
</body>

</html>
